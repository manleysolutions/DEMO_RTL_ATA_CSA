(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const d of t)if(d.type==="childList")for(const e of d.addedNodes)e.tagName==="LINK"&&e.rel==="modulepreload"&&s(e)}).observe(document,{childList:!0,subtree:!0});function i(t){const d={};return t.integrity&&(d.integrity=t.integrity),t.referrerPolicy&&(d.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?d.credentials="include":t.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function s(t){if(t.ep)return;t.ep=!0;const d=i(t);fetch(t.href,d)}})();let m=[];function r(n,o="info"){const i=document.getElementById("toast-container"),s=document.createElement("div");s.className=`
    px-4 py-2 rounded shadow text-white animate-fadeIn
    ${o==="success"?"bg-green-600":o==="error"?"bg-red-600":"bg-blue-600"}
  `,s.textContent=n,i.appendChild(s),setTimeout(()=>{s.classList.add("opacity-0","transition-opacity","duration-500"),setTimeout(()=>s.remove(),500)},3e3)}window.pingSite=async n=>{const i=await(await fetch(`/api/ping/${n}`,{method:"POST"})).json();r(i.msg,i.ok?"success":"error"),await u()};window.rebootSite=async n=>{const i=await(await fetch(`/api/reboot/${n}`,{method:"POST"})).json();r(i.msg,i.ok?"success":"error")};window.fetchLogs=async n=>{const i=await(await fetch(`/api/logs/${n}`)).json();r(`Logs for site ${n} loaded.`,"info"),console.log("Logs:",i.logs)};function h(n){return`
    <div class="ml-6 mt-2 p-2 bg-gray-50 rounded border">
      <h4 class="font-semibold mb-2">FXS Lines</h4>
      <ul class="grid grid-cols-6 gap-2 text-sm">
        ${n.map(o=>`<li class="px-2 py-1 bg-white shadow rounded">Line ${o}</li>`).join("")}
      </ul>
    </div>
  `}function b(n){const o=document.getElementById("sitesTable");o.innerHTML="";const i=n.length,s=n.filter(e=>e.status==="online").length,t=n.filter(e=>e.status==="offline").length,d=n.filter(e=>e.status==="pending").length;document.getElementById("totalSites").textContent=i,document.getElementById("onlineSites").textContent=s,document.getElementById("offlineSites").textContent=t,document.getElementById("pendingSites").textContent=d,n.forEach(e=>{var g;const c=document.createElement("tr");c.className="border-b cursor-pointer hover:bg-gray-50";const f=e.status==="online"?"text-green-600 font-semibold":e.status==="offline"?"text-red-600 font-semibold":"text-yellow-600 font-semibold",p=e.lastSync?new Date(e.lastSync).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"}):"—";if(c.innerHTML=`
      <td class="px-4 py-2">${e.id}</td>
      <td class="px-4 py-2">${e.location}</td>
      <td class="px-4 py-2 ${f}">${e.status}</td>
      <td class="px-4 py-2">${e.device||"—"}</td>
      <td class="px-4 py-2">${((g=e.fxsLines)==null?void 0:g.length)||0}</td>
      <td class="px-4 py-2">${p}</td>
      <td class="px-4 py-2 space-x-2">
        <button onclick="pingSite(${e.id})" class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">Ping</button>
        <button onclick="rebootSite(${e.id})" class="bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600">Reboot</button>
        <button onclick="fetchLogs(${e.id})" class="bg-gray-700 text-white px-3 py-1 rounded hover:bg-gray-800">Logs</button>
      </td>
    `,o.appendChild(c),e.fxsLines&&e.fxsLines.length>0){const a=document.createElement("tr"),y=7;a.innerHTML=`<td colspan="${y}">${h(e.fxsLines)}</td>`,a.className="hidden site-lines-"+e.id,c.addEventListener("click",()=>{a.classList.toggle("hidden")}),o.appendChild(a)}}),document.getElementById("lastUpdated").textContent="Updated: "+new Date().toLocaleString()}async function u(){m=await(await fetch("/api/sites")).json(),l()}function l(){const n=document.getElementById("statusFilter").value,o=document.getElementById("deviceFilter").value,i=document.getElementById("searchInput").value.toLowerCase();let s=[...m];n&&(s=s.filter(t=>t.status===n)),o&&(s=s.filter(t=>t.device===o)),i&&(s=s.filter(t=>t.location.toLowerCase().includes(i))),b(s)}document.getElementById("filter-total").addEventListener("click",()=>{document.getElementById("statusFilter").value="",l()});document.getElementById("filter-online").addEventListener("click",()=>{document.getElementById("statusFilter").value="online",l()});document.getElementById("filter-offline").addEventListener("click",()=>{document.getElementById("statusFilter").value="offline",l()});document.getElementById("filter-pending").addEventListener("click",()=>{document.getElementById("statusFilter").value="pending",l()});document.getElementById("statusFilter").addEventListener("change",l);document.getElementById("deviceFilter").addEventListener("change",l);document.getElementById("searchInput").addEventListener("input",l);u();setInterval(u,1e4);
